actions.precombat+=/moonkin_form
actions.precombat+=/wrath
actions.precombat+=/wrath
actions.precombat+=/starfire

actions=variable,name=passive_asp,value=6%spell_haste+talent.natures_balance+((talent.bounteous_bloom&buff.bounteous_bloom.up)*15)+talent.orbit_breaker*dot.moonfire.ticking*(buff.orbit_breaker.stack>(27-2*buff.solstice.up))*24

actions+=/run_action_list,name=st

actions.st+=/sunfire,target_if=remains<3|refreshable
actions.st+=/moonfire,target_if=remains<3&refreshable
actions.st+=/fury_of_elune,if=5+variable.passive_asp<astral_power.deficit
actions.st+=/celestial_alignment,if=!buff.ca_inc.up
actions.st+=/incarnation,if=!buff.ca_inc.up
actions.st+=/use_item,slot=trinket1,if=buff.ca_inc.up
actions.st+=/use_item,slot=trinket2,if=buff.ca_inc.up
actions.st+=/potion,if=buff.ca_inc.up
actions.st+=/force_of_nature,if=buff.ca_inc.up|cooldown.ca_inc.remains>15
actions.st+=/starfall,if=buff.starweavers_warp.up
actions.st+=/starsurge,if=talent.starlord&buff.starlord.stack<3
actions.st+=/sunfire,target_if=refreshable
actions.st+=/moonfire,target_if=refreshable&(!talent.treants_of_the_moon|cooldown.force_of_nature.remains>3&!buff.harmony_of_the_grove.up)
actions.st+=/convoke_the_spirits,if=buff.ca_inc.up
actions.st+=/new_moon,if=astral_power.deficit>variable.passive_asp+energize_amount|fight_remains<20|cooldown.ca_inc.remains>15
actions.st+=/half_moon,if=astral_power.deficit>variable.passive_asp+energize_amount&(buff.eclipse_lunar.remains>execute_time|buff.eclipse_solar.remains>execute_time)|fight_remains<20|cooldown.ca_inc.remains>15
actions.st+=/full_moon,if=astral_power.deficit>variable.passive_asp+energize_amount&(buff.eclipse_lunar.remains>execute_time|buff.eclipse_solar.remains>execute_time)|fight_remains<20|cooldown.ca_inc.remains>15
actions.st+=/starsurge,if=buff.starweavers_weft.up|buff.touch_the_cosmos.up
actions.st+=/starsurge,if=astral_power.deficit<variable.passive_asp+action.wrath.energize_amount+(action.starfire.energize_amount+variable.passive_asp)*(buff.eclipse_solar.remains<(gcd.max+action.starfire.cast_time))
actions.st+=/force_of_nature,if=!hero_tree.keeper_of_the_grove
actions.st+=/wild_mushroom,if=!prev_gcd.1.wild_mushroom&dot.fungal_growth.remains<2
actions.st+=/starfire,if=talent.lunar_calling
actions.st+=/wrath
